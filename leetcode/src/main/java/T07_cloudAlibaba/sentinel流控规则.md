[TOC]

## 1.流控规则基本介绍

![image-20211211142807725](https://cdn.jsdelivr.net/gh/hx1098/Algorithm@master/img/nacos/20211211142807.png)

#### 名词解释

- 资源名：唯一名称，默认请求路径
- 针对来源：Sentinel可以针对调用者进行限流，填写微服务名，默认default（不区分来源）
- 阈值类型/单机阈值：
  - QPS（每秒钟的请求数量）：当调用该API的QPS达到阈值的时候，进行限流
  - 线程数：当调用该API的线程数量达到阈值的时候，进行限流
- 是否集群：当前不需要集群
- 流控模式：
  - 直接：API达到限流条件时，直接限流
  - 关联：当关联的资源达到阈值时，就限流自己
  - 链路：只记录指定链路上的流量（指定资源从入口资源进来的流量，如果达到阈值，就进行限流）(API级别的针对来源)
- 流控效果：
  - 快速失败：直接失败，抛异常
  - Wam Up：根据codeFactor（冷加载因子，默认3）的值，从阈值/codeFacotor，经过预热时长，才达到设置的QPS阈值
  - 排队等待：匀速排队，让请求以匀速的速度通过，阈值类型必须设置为QPS，否则无效



## 2.QPS直接失败案例

1.qps可以从簇点链路中添加, 也可以从流控规则汇总添加, 1秒只能访问一次,超过就报错

![image-20211211143201312](https://cdn.jsdelivr.net/gh/hx1098/Algorithm@master/img/nacos/20211211143201.png)

手速过快时候就有sentinel的限制的提示了.

![image-20211211143236246](https://cdn.jsdelivr.net/gh/hx1098/Algorithm@master/img/nacos/20211211143236.png)

## 3,线程数失败案例

开启来个testA, 每个模拟代码执行是时间, 先让他睡上个1秒钟, 可以看到两个同时请求的时候, 就会直接报错了, 太简单, 不过多演示了, 但是这里和上面的有责本质的区别, 一个是以线程来控制的, 一个是以qps来控制的. 

![image-20211211143753241](https://cdn.jsdelivr.net/gh/hx1098/Algorithm@master/img/nacos/20211211143753.png)

