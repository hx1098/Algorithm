[TOC]

#### 1.官网介绍

http://rocketmq.apache.org/ 不多说了,自己看

#### 2.安装

```bash
#时间校准
yum install ntpdate
ntpdate ntp1.aliyun.com
```



这里我直接去github选择461版本的  https://github.com/apache/rocketmq/tree/release-4.6.1/docs/cn 源码进行编译安装， 或者里面又编译好的， 自行下载直接安装启动就行.

**安装前的准备**: linux  jdk8 maven

```bash
#mvn安装
wget https://mirrors.tuna.tsinghua.edu.cn/apache/maven/maven-3/3.6.3/binaries/apache-maven-3.6.3-bin.tar.gz
tar -zxf apache-maven-3.6.3-bin.tar.gz
mv apache-maven-3.6.3 /usr/local/
```

**mvn添加阿里云镜像**

修改`maven/conf`目录下的`settings.xml`

在`mirrors`节点下添加

```xml
<mirror> 
    <id>aliyun-maven</id> 
    <mirrorOf>*</mirrorOf> 
    <name>aliyun maven</name> 
    <url>http://maven.aliyun.com/nexus/content/groups/public</url> 
</mirror>
```



```bash
#改名
mv apache-maven-3.6.3/  maven
cd /maven/conf
vi setting.xml
```

**修改环境变量**

```bash
#编辑系统变量
vim /etc/profile
export M2_HOME=/usr/local/maven
export PATH=$PATH:$M2_HOME/bin
#立即生效
source /etc/profile
#测试
mvn -v
```

上传两个文件,一个主分支,一个拓展

```bash
rocketmq-master.zip
rocketmq-externals-master

unzip rocketmq-externals-master.zip
unzip rocketmq-master.zip

cd rocketmq-master/
#编译
mvn -Prelease-all -DskipTests clean install -U
#编译成功后会有一个文件夹.
cd distribution/
cd target
#将编译好的文件移动
mv rocketmq-4.6.1/ /usr/local/
```



**启动MQ**

```bash
cd /usr/local
cd rocketmq/bin
#需要启动 mqbroker  mqnamesrv 这两个

#启动mqnamesrv
./mqnamesrv

#新开一个窗口启动mqbroker
./mqbroker 
#此时会报错误,Cannot allocate memory' (errno=12), 无法分配内存
#java虚拟机启动参数设置的太大造成的,所以需要设置jvm
#将jvm的配置改掉,重新启动
vim runbroker.sh
JAVA_OPT="${JAVA_OPT} -server -Xms512m -Xmx512m -Xmn128m"

#如果还提示host错误的话, 就改一下host
vi /etc/host
192.168.0.123 node-01
#再次尝试即可

#指定端口进行连接到mqnamesrv,
#./mqbroker -n localhost:9876 autoCreateTopicEnable=true
#实际工作中用这种方式
sh mqbroker -n 192.168.190.132:9876 -c ../conf/broker.conf autoCreateTopicEnable=true
```



**测试**

注意:  启动mqbroker时候一定要指定mqnamesrv的端口.

```bash
#这个会报错,是因为没有哦指定链接
./tools.sh org.apache.rocketmq.example.quickstart.Producer
```



```bash
java.lang.IllegalStateException: org.apache.rocketmq.remoting.exception.RemotingConnectException: connect to null failed
	at org.apache.rocketmq.client.impl.factory.MQClientInstance.updateTopicRouteInfoFromNameServer(MQClientInstance.java:681)
```

解决方案: 

```bash
vim tools.sh
#指定nameserver, 有点类似zookeeper, 
#必须在 export CLASSPATH=.:${BASE_DIR}/conf:${CLASSPATH} 之后添加,否则也会报错
export NAMESRV_ADDR=localhost:9876

```



```bash
#消费者
./tools.sh org.apache.rocketmq.example.quickstart.Consumer
```



### 3.控制台rocketmq-console编译安装

#### 下载

https://github.com/apache/rocketmq-externals

**中文指南**

https://github.com/apache/rocketmq-externals/blob/master/rocketmq-console/doc/1_0_0/UserGuide_CN.md

#### 上传到服务器并解压缩

#### 编译

进入`rocketmq-console`目录

执行编译

```
mvn clean package -Dmaven.test.skip=true
```

#### 启动

```bash
mv rocketmq-console-ng-1.0.1.jar /usr/local/
#启动 这种的方式需要你自己手动输入集群的地址
java -jar rocketmq-console-ng-1.0.1.jar
#访问
http://192.168.190.132:8080
```

![image-20210613153053127](D:\资料整理\learningSource\mq消息中间件\images\image-20210613153053127.png)

或者: 

```bash

./mqnamesrv -n 192.168.190.132:9876
sh bin/mqbroker -n 192.168.190.132:9876 -c conf/broker.conf autoCreateTopicEnable=true
#直接指定服务器的地址，
java -jar rocketmq-console-ng-1.0.1.jar --rocketmq.config.namesrvAddr=192.168.190.132:9876
java -jar rocketmq-console-ng-1.0.1.jar --rocketmq.config.namesrvAddr=192.168.190.132:9876
```



