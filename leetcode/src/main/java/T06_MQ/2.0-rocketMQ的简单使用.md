[TOC]

#### 1.启动

```bash
#mqnamesrv启动
./mqnamesrv -n 192.168.190.132:9876
#启动broker
sh bin/mqbroker -n 192.168.190.132:9876 -c conf/broker.conf autoCreateTopicEnable=true
#启动后台管理
java -jar rocketmq-console-ng-1.0.1.jar --rocketmq.config.namesrvAddr=192.168.190.132:9876

```

如果不指定ip的话, 在链接发送消息时候就会报如下错误, 反正就是阿里的这个mq坑死我了

```bash
#错误信息
closeChannel: close the connection to remote address[] result: true
```



#### 2.连接

简单的发送一条消息

**生产者**

```java

public class Producer {
    public static void main(String[] args) throws Exception {
        DefaultMQProducer producer = new DefaultMQProducer("xoxoGP");

//        设置namesever的地址;
        producer.setNamesrvAddr("192.168.190.132:9876");
        producer.start();
//        发送消息
//        topic 消息将要发送的地址
//        body  消息中将要发送的数据

        Message msg = new Message("myTopic001","第一条数据".getBytes());
        producer.send(msg);
        producer.shutdown();

    }
}
```

**消费者**

```java
public class Consumer {
    public static void main(String[] args) throws Exception {
        DefaultMQPushConsumer consumer = new DefaultMQPushConsumer("group-001");
        consumer.setNamesrvAddr("192.168.190.132:9876");

//        每一个consumer关注一个topic
//        过滤器表示不过滤
        consumer.subscribe("myTopic001", "*");
        consumer.registerMessageListener(new MessageListenerConcurrently() {
            @Override
            public ConsumeConcurrentlyStatus consumeMessage(List<MessageExt> msgs, ConsumeConcurrentlyContext context) {
                for (MessageExt msg : msgs) {
                    System.out.println(new String(msg.getBody()));
                }
//                默认情况下,这条消息只会被一个consumer  消息到点对点
                return ConsumeConcurrentlyStatus.CONSUME_SUCCESS;
            }
        });
        consumer.start();
        System.out.println("start....");
    }
}
```

**maven**

```xml
		<dependency>
            <groupId>org.apache.rocketmq</groupId>
            <artifactId>rocketmq-client</artifactId>
            <version>4.6.1</version>
        </dependency>
```





#### 4.
